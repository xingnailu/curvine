# Curvine éšæœºå†™é‡å è¦†ç›–æœºåˆ¶è¯¦ç»†è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†Curvineéšæœºå†™æµ‹è¯•ä¸­ï¼Œå¤šæ¬¡éšæœºå†™å…¥æ—¶é•¿åº¦å’Œåç§»é‡å¯¼è‡´æ•°æ®è¦†ç›–çš„å„ç§æƒ…å†µï¼Œä»¥åŠæ™ºèƒ½é‡å å¤„ç†ç®—æ³•å¦‚ä½•æ­£ç¡®å¤„ç†è¿™äº›è¦†ç›–åœºæ™¯ã€‚

---

## ğŸ¯ æ ¸å¿ƒé—®é¢˜

åœ¨éšæœºå†™æµ‹è¯•ä¸­ï¼Œç”±äºå†™å…¥çš„**åç§»é‡**å’Œ**é•¿åº¦**éƒ½æ˜¯éšæœºç”Ÿæˆçš„ï¼Œä¼šå‡ºç°æ–°å†™å…¥ä¸å·²æœ‰æ•°æ®é‡å çš„æƒ…å†µã€‚ä¼ ç»Ÿæ–¹æ³•ç®€å•åˆ é™¤è¢«è¦†ç›–çš„æ—§è®°å½•ï¼Œå¯¼è‡´éªŒè¯æ—¶å‡ºç°"æ•°æ®ä¸¢å¤±"çš„å‡è±¡ã€‚

### é—®é¢˜ç¤ºä¾‹
```
é¢„æœŸéªŒè¯: è¯»å–1MBä½ç½®çš„5KBæ•°æ®
å®é™…ç»“æœ: åªèƒ½è¯»å–3KBæ•°æ® (å2KBè¢«è¦†ç›–)
é”™è¯¯æ˜¾ç¤º: "è¯»å–é•¿åº¦ä¸åŒ¹é…"
```

---

## ğŸ”¬ é‡å è¦†ç›–çš„å…­ç§æƒ…å†µ

### æƒ…å†µ1ï¼šå®Œå…¨è¦†ç›– (Complete Overwrite)
```
åŸæœ‰æ•°æ®A: [====== A ======]     (åç§»:1000, é•¿åº¦:500)
æ–°å†™å…¥B:   [======== B ========] (åç§»:900,  é•¿åº¦:700)

ç»“æœ:      [======== B ========]
           åç§»:900  é•¿åº¦:700

å¤„ç†æ–¹å¼: åˆ é™¤Aï¼Œä¿ç•™B
éªŒè¯æ•°æ®: Bå®Œæ•´æ•°æ®
```

### æƒ…å†µ2ï¼šå‰éƒ¨è¦†ç›– (Front Overlap)
```
åŸæœ‰æ•°æ®A: [====== A ======]     (åç§»:1000, é•¿åº¦:500)
æ–°å†™å…¥B:       [==== B ====]     (åç§»:1100, é•¿åº¦:300)

ç»“æœ:      [==A==][==== B ====][==A==]
           ä¿ç•™å‰éƒ¨     æ–°æ•°æ®     ä¿ç•™åéƒ¨
           
å¤„ç†æ–¹å¼: Aåˆ†å‰²ä¸ºå‰éƒ¨(1000,100)å’Œåéƒ¨(1400,100)
éªŒè¯æ•°æ®: Aå‰éƒ¨ + Bå®Œæ•´ + Aåéƒ¨
```

### æƒ…å†µ3ï¼šåéƒ¨è¦†ç›– (Rear Overlap)  
```
åŸæœ‰æ•°æ®A: [====== A ======]     (åç§»:1000, é•¿åº¦:500)
æ–°å†™å…¥B: [==== B ====]           (åç§»:800,  é•¿åº¦:300)

ç»“æœ:    [==== B ====][==== A ====]
         æ–°æ•°æ®         ä¿ç•™åéƒ¨
         
å¤„ç†æ–¹å¼: Aåˆ†å‰²ï¼Œä¿ç•™åéƒ¨(1100,400)
éªŒè¯æ•°æ®: Bå®Œæ•´ + Aåéƒ¨
```

### æƒ…å†µ4ï¼šä¸­é—´è¦†ç›– (Middle Overlap)
```
åŸæœ‰æ•°æ®A: [======== A ========] (åç§»:1000, é•¿åº¦:800)
æ–°å†™å…¥B:     [==== B ====]       (åç§»:1200, é•¿åº¦:200)

ç»“æœ:    [==A==][== B ==][==A==]
         å‰éƒ¨     æ–°æ•°æ®    åéƒ¨
         
å¤„ç†æ–¹å¼: Aåˆ†å‰²ä¸ºå‰éƒ¨(1000,200)å’Œåéƒ¨(1400,400)
éªŒè¯æ•°æ®: Aå‰éƒ¨ + Bå®Œæ•´ + Aåéƒ¨
```

### æƒ…å†µ5ï¼šå¤šé‡è¦†ç›– (Multiple Overlaps)
```
åŸæœ‰æ•°æ®A: [====== A ======]     (åç§»:1000, é•¿åº¦:500)
åŸæœ‰æ•°æ®C: [====== C ======]     (åç§»:1600, é•¿åº¦:400)
æ–°å†™å…¥B:   [======== B ========] (åç§»:1200, é•¿åº¦:600)

ç»“æœ:      [==A==][======== B ========][==C==]
           ä¿ç•™    è¦†ç›–Aåéƒ¨+è¦†ç›–Cå‰éƒ¨   ä¿ç•™
           
å¤„ç†æ–¹å¼: Aä¿ç•™å‰éƒ¨ï¼ŒCä¿ç•™åéƒ¨ï¼ŒBä¸ºæ–°æ•°æ®
éªŒè¯æ•°æ®: Aå‰éƒ¨ + Bå®Œæ•´ + Cåéƒ¨
```

### æƒ…å†µ6ï¼šé“¾å¼è¦†ç›– (Chain Overlaps)
```
æ—¶åº1: å†™å…¥A [====== A ======]    (åç§»:1000, é•¿åº¦:500)
æ—¶åº2: å†™å…¥B   [==== B ====]      (åç§»:1200, é•¿åº¦:300)
æ—¶åº3: å†™å…¥C     [== C ==]        (åç§»:1300, é•¿åº¦:100)

æœ€ç»ˆ:  [==A==][=B=][C][=B=][=A=]
       ä¿ç•™   Bå‰  C  Bå Aå
       
å¤„ç†æ–¹å¼: é€’å½’åˆ†å‰²ï¼Œæ­£ç¡®ç»´æŠ¤æ‰€æœ‰ç‰‡æ®µ
```

---

## ğŸ§  æ™ºèƒ½é‡å å¤„ç†ç®—æ³•

### æ ¸å¿ƒç®—æ³•æµç¨‹

```rust
fn process_overlap_and_update_records() {
    1. æ£€æµ‹é‡å : analyze_overlaps()
    2. åˆ†ç±»å¤„ç†:
       - CompleteOverwrite -> åˆ é™¤æ—§è®°å½•
       - PartialOverwrite  -> æ™ºèƒ½åˆ†å‰²
    3. åˆ†å‰²é‡ç»„: merge_overlapped_records()
    4. é‡æ–°è®¡ç®—æ ¡éªŒå’Œ
    5. æ›´æ–°è®°å½•é›†åˆ
}
```

### åˆ†å‰²ç®—æ³•è¯¦è§£

```rust
fn merge_overlapped_records() {
    let existing_end = existing.offset + existing.length;
    let new_end = new.offset + new.length;
    
    // å‰éƒ¨ä¿ç•™
    if existing.offset < new.offset {
        let prefix = existing.data[0..prefix_len];
        create_record(existing.offset, prefix);
    }
    
    // åéƒ¨ä¿ç•™  
    if existing_end > new_end {
        let suffix = existing.data[suffix_start..];
        create_record(new_end, suffix);
    }
}
```

---

## ğŸ“Š æµ‹è¯•ç”¨ä¾‹ä¸éªŒè¯

### å…¸å‹æµ‹è¯•åœºæ™¯

#### åœºæ™¯1ï¼šéƒ¨åˆ†è¦†ç›–éªŒè¯
```
è¾“å…¥:
  å†™å…¥1: offset=8793376, length=19705, data=A
  å†™å…¥2: offset=8798468, length=14705, data=B

æ™ºèƒ½å¤„ç†ç»“æœ:
  è®°å½•1: offset=8793376, length=5092,  data=A[0:5092]
  è®°å½•2: offset=8798468, length=14705, data=B
  è®°å½•3: offset=8813173, length=147,   data=A[19558:19705]

éªŒè¯é€šè¿‡:
  âœ… åç§» 8793376 éªŒè¯æˆåŠŸ: 5092B
  âœ… åç§» 8798468 éªŒè¯æˆåŠŸ: 14705B  
  âœ… åç§» 8813173 éªŒè¯æˆåŠŸ: 147B
```

#### åœºæ™¯2ï¼šå¤šé‡è¦†ç›–éªŒè¯
```
è¾“å…¥:
  æ•°æ®A: offset=3279804, length=30000
  å†™å…¥B: offset=3283564, length=5000 (è¦†ç›–Açš„ä¸­é—´éƒ¨åˆ†)

æ™ºèƒ½å¤„ç†ç»“æœ:
  å‰éƒ¨: offset=3279804, length=3760,  data=A[0:3760]
  ä¸­é—´: offset=3283564, length=5000,  data=B
  åéƒ¨: offset=3288564, length=21240, data=A[8760:30000]

éªŒè¯æ•ˆæœ:
  æ•°æ®å®Œæ•´æ€§: 100% (æ‰€æœ‰æ•°æ®ç‰‡æ®µéƒ½æ­£ç¡®éªŒè¯)
  é›¶éªŒè¯é”™è¯¯: æ— "è¯»å–é•¿åº¦ä¸åŒ¹é…"
```

## ğŸ¯ ä½¿ç”¨æŒ‡å—

### è¿è¡Œæ™ºèƒ½é‡å æµ‹è¯•
```bash
# æ ‡å‡†æ¨¡å¼
./run_random_write_test.sh

# è¯¦ç»†æ¨¡å¼ï¼ˆæ˜¾ç¤ºé‡å å¤„ç†è¿‡ç¨‹ï¼‰
./run_random_write_test.sh --verbose
```

### æ—¥å¿—è§£è¯»
```
ğŸ”„ å¤„ç† 1 ä¸ªé‡å åŒºåŸŸ              # æ£€æµ‹åˆ°é‡å 
ğŸ“Œ ä¿ç•™å‰éƒ¨: åç§» X, é•¿åº¦ YB      # Açš„æœªè¦†ç›–å‰éƒ¨
ğŸ“Œ ä¿ç•™åéƒ¨: åç§» X, é•¿åº¦ YB      # Açš„æœªè¦†ç›–åéƒ¨
ğŸ”§ æ›´æ–°è®°å½•: åç§» X, é•¿åº¦ YB      # é‡æ–°è®¡ç®—æ ¡éªŒå’Œ
âœ… åç§» X éªŒè¯æˆåŠŸ: YB           # éªŒè¯é€šè¿‡
ğŸ‰ æ‰€æœ‰æ•°æ®éªŒè¯é€šè¿‡ï¼             # å®Œç¾ç»“æœ
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
curvine-tests/
â”œâ”€â”€ examples/
â”‚   â””â”€â”€ random_write_test.rs          # ä¸»æµ‹è¯•æ–‡ä»¶ï¼ˆæ™ºèƒ½é‡å å¤„ç†ï¼‰
â”œâ”€â”€ run_random_write_test.sh          # è¿è¡Œè„šæœ¬
â”œâ”€â”€ overlap_coverage_explanation.md   # è¯¦ç»†æŠ€æœ¯æ–‡æ¡£
â””â”€â”€ README_random_write_test.md       # æœ¬è¯´æ˜æ–‡ä»¶
```

## ğŸ¯ æµ‹è¯•é…ç½®

```rust
RandomWriteTestConfig {
    test_files_count: 3,               // æµ‹è¯•æ–‡ä»¶æ•°é‡
    file_size_mb: 10,                  // å•æ–‡ä»¶å¤§å° 10MB
    write_operations_per_file: 30,     // æ¯æ–‡ä»¶30æ¬¡éšæœºå†™
    max_write_chunk_size_kb: 32,       // æœ€å¤§å†™å—32KB
    test_dir: "/random_write_test",    // æµ‹è¯•ç›®å½•
}
```